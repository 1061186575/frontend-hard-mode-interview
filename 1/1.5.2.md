# 壹.5.2 了解TCP/IP、UDP、TLS

了解一点底层网络通信原理，对日常工作有很大的帮助，减少与后端工程师的“日常沟通摩擦”，增强互信理解和共鸣。而且在面试过程中，很多公司会考察前端工程师的知识广度，TCP/IP、UDP、TLS是被高频问到的。

## 壹.5.2.1 TCP/IP的三次握手

![](../.gitbook/assets/image%20%282%29.png)

如上图，三次握手分别是：

### SYN

客户端选择一个随机序列号x，并发送一个SYN分组，其中可能还包括其他TCP标志和选项。 

### SYN ACK

服务器给x加1，并选择自己的一个随机序列号y，追加自己的标志和选项，然后返回响应。 

### ACK

客户端给x和y加1并发送握手期间的最后一个ACK分组。 

## 壹.5.2.2 握手对延迟的影响

三次握手完成后，客户端与服务器之间就可以通信了。客户端可以在发送ACK分组之后立即发送数据，而服务器必须等接收到ACK分组之后才能发送数据。这个启动通信的过程适用于所有TCP连接，因此对所有使用TCP的应用具有非常大的性能影响，因为每次传输应用数据之前，都必须经历一次完整的往返。

举个例子，如果客户端在纽约，服务器在伦敦，要通过光纤启动一次新的TCP连接，光握手至少就要花56 ms：向伦敦发送分组需要28 ms，响应发回纽约又要28 ms。在此，连接的带宽对时间没有影响，延迟完全取决于客户端和服务器之间的往返时间，这其中主要是纽约到伦敦之间的传输时间。 三次握手带来的延迟使得每创建一个新TCP连接都要付出很大代价。而这也决定了提高TCP应用性能的关键，在于想办法重用连接。

重用TCP连接有一个方案叫“TCP Fast Open”（TFO），Linux 3.7及之后的内核已经在客户端和服务器中支持TFO，具体内容可以查阅[IETF规范](https://tools.ietf.org/html/rfc7413)。

## 壹.5.2.3 UDP

有些应用程序可能并不需要可靠的交付或者不需要按顺序交付。比如，每个分组都是独立的消息，那么按顺序交付就没有任何必要。而且，如果每个消息都会覆盖之前的消息，那么可靠交付同样也没有必要了。可惜的是，TCP不支持这种情况，所有分组必须按顺序交付。 

无需按序交付数据或能够处理分组丢失的应用程序，以及对延迟或抖动要求很高的应用程序，最好选择UDP等协议。

## 壹.5.2.4 TLS

//todo

